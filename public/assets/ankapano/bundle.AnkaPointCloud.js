!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AnkaPointCloud=e():t.AnkaPointCloud=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}({11:function(t,e,n){"use strict";n.r(e),n.d(e,"PointCloudPlugin",(function(){return le}));var r,o,i,a,u,s,c,l,f,h,p,y,d,v,b,_,m,g,w,P,E,S,O,D,T,A,k=0,R={},j=[];function I(t){throw new Error("cannot created instance from a static class")}if(I.addByID=function(t,e){var n={id:e,timestamp:Date.now(),points:t};if(void 0===R[e])k++;else for(var r=R[e].timestamp,o=0;o<j.length;o++)if(r===j[o].timestamp){j.splice(o,1);break}j.push(n),R[e]=n,function(){if(k>400){var t=j.length-400,e=j.splice(0,t);e.forEach((function(t){return delete R[t.id]})),k-=e.length}}()},I.getByID=function(t){var e=R[t];if(void 0!==e)return e.points},window.PatchPooler=I,!window.AnkaPanAPI)throw new Error("AnkaPanAPI could be found in page.");if(o=(r=window.AnkaPanAPI).Base,h=r.CursorManager,i=r.PanoGL,c=r.AnkaPromise,l=r.AnkaFetch,p=r.Renderer,_=r.Utils.setDef,r.MeshMousePicker,!window.AnkaScalable)throw new Error("AnkaScalable could be found in page.");if(a=window.AnkaScalable,y=a.SLine,a.EventLine,d=a.SPoint,v=a.SHLine,b=a.SPolygon,u=a.GeomDataHolder,f=a.GeometryObserver,s=a.ScalablePlugin,!window.THREE)throw new Error("THREE.js could be found in page.");function C(t,e,n){return{drawType:t,type:"onStatusChange",status:"FINISHED",isSuccessful:e,feature:n}}function M(t,e,n,r){var o={drawType:t,type:"onStatusChange",status:"POINT_ADDED",isSuccessful:e,feature:n};return null!==r&&(o.lon=r[0],o.lat=r[1],o.alt=r[2]),o}function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return B(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function H(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=W(t);if(e){var o=W(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return U(this,n)}}function U(t,e){if(e&&("object"===x(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return F(t)}function F(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}THREE.Mesh,THREE.BoxBufferGeometry,E=THREE.BufferGeometry,P=THREE.BufferAttribute,THREE.SphereBufferGeometry,THREE.MeshBasicMaterial,S=THREE.Box3,D=THREE.PointsMaterial,w=THREE.Color,g=THREE.Scene,THREE.Object3D,O=THREE.Geometry,T=THREE.Sphere,m=THREE.Points,A=THREE.Vector3;var z,V,q,$={},K=1024,Y=512;var Q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(a,t);var e,n,r,o=H(a);function a(t,e,n){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this))._panogl=t,r._depthEnabled=!1,r._points=[],r.type="unknown",r._allowClick=!0,r.onClick=r.onClick.bind(F(r)),r._onDataChange=r._onDataChange.bind(F(r));var s=new u(e,[],{});s.type=n,s.setStatus(u.STATUS.DRAWING),f.addGeometries([s]),r.dh=s,t.addEvent(i.SAFE_CLICK2D,r.onClick),t.disableGroundNav(!0);var c=t.getGroundMaster();return c.disableNavigation(),c.showGroundSymbol(!1),h.setCursor("crosshair",666),r.onKeydown=r.onKeydown.bind(F(r)),document.addEventListener("keydown",r.onKeydown),r._serviceID=0,r._currentDepth={},r}return e=a,(n=[{key:"serviceID",get:function(){return this._serviceID},set:function(t){this._serviceID=t}},{key:"disableDepth",value:function(){this._depthEnabled=!1;var t=this._panogl;t.removeEvent(i.MOUSE_MOVE2D,this.onMouseMove),t.removeEvent(AnkaPanAPI.PanoGLV2.LOCATION_CHANGE,this._onDataChange)}},{key:"onKeydown",value:function(t){27===t.keyCode&&this.endBadDraw()}},{key:"enableDepth",value:function(){this.disableDepth(),this._depthEnabled=!0;var t=this._panogl;t.addEvent(i.MOUSE_MOVE2D,this,this.onMouseMove),t.addEvent(AnkaPanAPI.PanoGLV2.LOCATION_CHANGE,this,this._onDataChange),this._downloadDepth()}},{key:"_downloadDepth",value:function(){var t=this,e=this._panogl.getCurrentPoint(),n=e.latlon,r=e.parent,o=e.img,i=e.dirname;if(this._currentDepth.depthPos!==n){o=o.replace(".jpeg",".png");var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){t._currentDepth.depthPos=n,function(t){void 0===z&&((z=document.createElement("div")).style.width="10px",z.style.height="10px",z.style.backgroundColor="#ff0000",z.style.position="absolute",z.style.zIndex=111),void 0===V&&(q=document.createElement("canvas"),V=q.getContext("2d"),q.width=t.width,q.height=t.height),V.clearRect(0,0,q.width,q.height),V.drawImage(t,0,0,t.width,t.height),q.style.position="absolute",q.style.top="0px",q.style.left="0px",K=t.width,Y=t.height,q.style.visibility="hidden"}(a)};var u=this._panogl.getCloudInstance().getURL();a.src="".concat(u,"depth/").concat(r,"/").concat(i,"/").concat(o)}}},{key:"_onDataChange",value:function(t){this._downloadDepth()}},{key:"onMouseMove",value:function(t){if(!V)return!1;var e=t.ray.direction.clone(),n=180*-Math.atan2(e.x,e.z)/Math.PI;n%=360;var r=Math.asin(-e.y),o=180*r/Math.PI,i=Math.floor(K*(n/360)),a=Math.floor(Y*((o+90)/179));i<0&&(i+=K),z.style.top=a+"px",z.style.left=i+"px";var u,s,c,l=V.getImageData(i,a,1,1);l=l.data;for(var f=!1,p=0,y=0;y<1;y++)if(u=l[p=4*y],s=l[p+1],c=l[p+2],0!==u||0!==s||0!==c){f=!0;break}if(t.onGui)h.setCursor("pointer",666);else if(f){$.valid=!0,$.yaw=n,$.pitch=o,$.dist=function(t,e,n){return t<<16|e<<8|n}(u,s,c)/1111,h.setCursor("crosshair",666);var d=$.yaw;d+=90;var v=$.dist,b=Math.sin(r)*v,_=Math.cos(r)*v,m=Math.cos(d/180*Math.PI)*_,g=Math.sin(d/180*Math.PI)*_,w=this._panogl.groundMaster.posToLoc({x:m,y:-b,z:g});$.position=w}else $.valid=!1,h.setCursor("not-allowed",666)}},{key:"endBadDraw",value:function(){var t=this.dh;t.setStatus(u.STATUS.BAD_COMPLETED),f.removeGeometry(t),this.throwEvent(C(this.type,!1,this.dh))}},{key:"destroy",value:function(){var t=this._panogl;this.disableDepth(),t.removeEvent(i.SAFE_CLICK2D,this.onClick),document.removeEventListener("keydown",this.onKeydown),t.disableGroundNav(!1);var e=t.getGroundMaster();e.enableNavigation(),e.showGroundSymbol(!0),h.setCursor("default",-1,!0),t.setDirty()}},{key:"allowClick",get:function(){return this._allowClick},set:function(t){this._allowClick=t,t?h.setCursor("crosshair",666):h.setCursor("progress",666)}},{key:"addPoint",value:function(t){throw new Error("addPoint Needs to be implemented")}},{key:"removeLastPoint",value:function(){var t,e,n;this._points.length>0&&(this._points.pop(),this.update()),this.throwEvent((t=this.type,e=!0,n=this.dh,{drawType:t,type:"onStatusChange",status:"LAST_POINT_REMOVED",isSuccessful:e,feature:n}))}},{key:"update",value:function(){throw new Error("update Needs to be implemented")}},{key:"endDraw",value:function(){this.endBadDraw()}},{key:"onClick",value:function(t){var e,n,r,o,i,a,u,s,c,l,f=this;if(this._panogl.isUserActive)if(2!==t.nativeEvent.button)if(1!==t.nativeEvent.button){if(!t.onGui)if(this._depthEnabled){if($.valid){var h=$.position;console.log(h),this.allowClick=!0,this.onPointsReceived([[h.lon,h.lat,h.alt]])}}else{var p=this._panogl.getCurrentPoint();if(this.allowClick){this.allowClick=!1;var y=(e={alt:p.altitude,lat:p.lat,lon:p.lon},n=t.ray,r=n.direction,o=1*Math.PI-Math.atan2(r.x,r.z),i=Math.asin(-r.y),a=e.lon,u=e.lat,s=e.alt,c=AnkaPanAPI.Utils.destinationPoint(u,a,90,180*o/Math.PI),l=s-90*Math.tan(i),[a,u,s,c.lon,c.lat,l]);this.queryLine(y).then((function(t){f.allowClick=!0,Array.isArray(t)&&f.onPointsReceived(t)})).catch((function(t){f.allowClick=!0,f.throwEvent({drawType:f.type,type:"onStatusChange",error:t,status:"POINT_ADDED_ERROR",isSuccessful:!1}),console.log(t)}))}}}else this.removeLastPoint();else this.endDraw()}},{key:"onPointsReceived",value:function(){throw new Error("onPointsReceived(points) Needs to be implemented")}},{key:"queryLine",value:function(t){var e=this;return new c((function(n,r){var o=L(t,6),i=o[0],a=o[1],u=o[2],s=o[3],c=o[4],f=o[5],h=e._panogl.getCloudInstance().getURL();l("".concat(h,"pc/ray/intercets2/").concat(e.serviceID,"/").concat(i,"/").concat(a,"/").concat(u,"/").concat(s,"/").concat(c,"/").concat(f)).then((function(t){return t.json()})).then((function(t){t.success&&t.points.length>0?n(t.points):n(null)})).catch(r)}))}}])&&N(e.prototype,n),r&&N(e,r),a}(o);function X(t){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function et(t,e){return(et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ot(t);if(e){var o=ot(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return rt(this,n)}}function rt(t,e){if(e&&("object"===X(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ot(t){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Q.NO_DEPTH=!1;var it=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&et(t,e)}(i,t);var e,n,r,o=nt(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,d,u.POINT)).type="Point",e}return e=i,(n=[{key:"addPoint",value:function(t){Array.isArray(t)?(this._points[0]=t,this.update(),this.throwEvent(M(this.type,!0,this.dh,t)),this.throwEvent(C(this.type,!0,this.dh))):this.throwEvent(C(this.type,!1,null))}},{key:"onPointsReceived",value:function(t){var e=t[0];this.addPoint(e)}},{key:"update",value:function(){var t=this;this._points.forEach((function(e){var n=J(e,3),r=n[0],o=n[1],i=n[2],a=t.dh;a.addPoint({lon:r,lat:o,alt:i}),a.setStatus(u.STATUS.COMPLETED)}))}}])&&tt(e.prototype,n),r&&tt(e,r),i}(Q);function at(t){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ut(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return st(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return st(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lt(t,e){return(lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=pt(t);if(e){var o=pt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ht(this,n)}}function ht(t,e){if(e&&("object"===at(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function pt(t){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var yt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lt(t,e)}(i,t);var e,n,r,o=ft(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,y,u.LINE)).type="Line",e}return e=i,(n=[{key:"endDraw",value:function(){var t=this.dh,e=!1;t.getPointLength()<2?t.setStatus(u.STATUS.BAD_COMPLETED):(e=!0,t.setStatus(u.STATUS.COMPLETED)),this.throwEvent(C(this.type,e,this.dh))}},{key:"onPointsReceived",value:function(t){var e=t[0];this.addPoint(e)}},{key:"addPoint",value:function(t){Array.isArray(t)?(this._points.push(t),this.update(),this.throwEvent(M(this.type,!0,this.dh,t))):this.throwEvent(M(this.type,!1,this.dh,null))}},{key:"update",value:function(){var t=this.dh;t.resetPoints(),t.setPoints(this._points.map((function(t){var e=ut(t,3);return{lon:e[0],lat:e[1],alt:e[2]}})))}}])&&ct(e.prototype,n),r&&ct(e,r),i}(Q);function dt(t){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return bt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mt(t,e){return(mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Pt(t);if(e){var o=Pt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return wt(this,n)}}function wt(t,e){if(e&&("object"===dt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mt(t,e)}(i,t);var e,n,r,o=gt(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,v,u.HLine)).type="HLine",e}return e=i,(n=[{key:"endDraw",value:function(){var t=this.dh,e=!1;t.getPointLength()<2?t.setStatus(u.STATUS.BAD_COMPLETED):(e=!0,t.setStatus(u.STATUS.COMPLETED)),this.throwEvent(C(this.type,e,this.dh))}},{key:"addPoint",value:function(t){if(console.log("dsdasdas"),Array.isArray(t)){this._points.push(t);var e=this.dh.getPointLength();console.log("dendjendhnehbh"),2===e&&this.endDraw(),this.update(),this.throwEvent(M(this.type,!0,this.dh,t))}else this.throwEvent(M(this.type,!1,this.dh,t))}},{key:"onPointsReceived",value:function(t){var e=t[0];this.addPoint(e)}},{key:"update",value:function(){var t=this.dh;t.resetPoints(),t.setPoints(this._points.map((function(t){var e=vt(t,3);return{lon:e[0],lat:e[1],alt:e[2]}})))}}])&&_t(e.prototype,n),r&&_t(e,r),i}(Q);function St(t){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function At(t,e){return(At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function kt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=jt(t);if(e){var o=jt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Rt(this,n)}}function Rt(t,e){if(e&&("object"===St(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var It=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}(i,t);var e,n,r,o=kt(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,b,u.POLYGON)).type="Polygon",e}return e=i,(n=[{key:"endDraw",value:function(){var t=this.dh,e=!1;if(t.getPointLength()<2)t.setStatus(u.STATUS.BAD_COMPLETED);else{e=!0;for(var n=this._points,r=n[0],o=n[1],i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=0;s<n.length;s++)n[s][2]>i&&(i=n[s][2]),n[s][2]<a&&(a=n[s][2]);var c=[r[0],r[1],i],l=[o[0],o[1],i],f=[o[0],o[1],a],h=[r[0],r[1],a],p=[r[0],r[1],i];this._points=[c,l,f,h,p],this.update(),t.setStatus(u.STATUS.COMPLETED)}this.throwEvent(C(this.type,e,this.dh))}},{key:"addPoint",value:function(t){Array.isArray(t)?(this._points.push(t),this.update(),this.throwEvent(M(this.type,!0,this.dh,t)),this._points.length>=2&&this.endDraw()):this.throwEvent(M(this.type,!1,this.dh,t))}},{key:"onPointsReceived",value:function(t){var e=t[0];this.addPoint(e)}},{key:"update",value:function(){var t=this.dh;t.resetPoints(),t.setPoints(this._points.map((function(t){var e=Ot(t,3);return{lon:e[0],lat:e[1],alt:e[2]}})))}}])&&Tt(e.prototype,n),r&&Tt(e,r),i}(Q);function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return xt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bt(t,e){return(Bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Nt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ht(t);if(e){var o=Ht(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Gt(this,n)}}function Gt(t,e){if(e&&("object"===Ct(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ht(t){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ut=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bt(t,e)}(i,t);var e,n,r,o=Nt(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,b,u.POLYGON)).type="Polygon",e}return e=i,(n=[{key:"endDraw",value:function(){var t=this.dh,e=!1;t.getPointLength()<3?t.setStatus(u.STATUS.BAD_COMPLETED):(e=!0,t.setStatus(u.STATUS.COMPLETED)),this.throwEvent(C(this.type,e,this.dh))}},{key:"addPoint",value:function(t){Array.isArray(t)?(this._points.push(t),this.update(),this.throwEvent(M(this.type,!0,this.dh,t))):this.throwEvent(M(this.type,!1,this.dh,null))}},{key:"onPointsReceived",value:function(t){var e=t[0];this.addPoint(e)}},{key:"update",value:function(){var t=this.dh;t.resetPoints(),t.setPoints(this._points.map((function(t){var e=Mt(t,3);return{lon:e[0],lat:e[1],alt:e[2]}})))}}])&&Lt(e.prototype,n),r&&Lt(e,r),i}(Q);function Ft(t){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return zt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qt(t,e){return(qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Yt(t);if(e){var o=Yt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Kt(this,n)}}function Kt(t,e){if(e&&("object"===Ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Yt(t){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qt(t,e)}(i,t);var e,n,r,o=$t(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t,y,u.LINE)).type="Line",e}return e=i,(n=[{key:"endDraw",value:function(){var t=this.dh,e=!1;t.getPointLength()<2?t.setStatus(u.STATUS.BAD_COMPLETED):(e=!0,t.setStatus(u.STATUS.COMPLETED)),this.throwEvent(C(this.type,e,this.dh))}},{key:"onPointsReceived",value:function(t){if(2===t.length){var e=Wt(t,2),n=e[0],r=e[1];this.addPoints([n,r]),this.endDraw()}}},{key:"queryLine",value:function(t){var e=this;return new c((function(n,r){var o=Wt(t,6),i=o[0],a=o[1],u=o[2],s=o[3],c=o[4],f=o[5],h=e._panogl.getCloudInstance().getURL();l("".concat(h,"pc/ray/intercets2/hline/").concat(e.serviceID,"/").concat(i,"/").concat(a,"/").concat(u,"/").concat(s,"/").concat(c,"/").concat(f)).then((function(t){return t.json()})).then((function(t){t.success&&t.points.length>0?n(t.points):n(null)})).catch(r)}))}},{key:"addPoint",value:function(t){Array.isArray(t)&&(this._points.push(t),this.update())}},{key:"addPoints",value:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){var n=t[e];this._points.push(n),this.throwEvent(M(this.type,!0,this.dh,n))}this.update()}else this.throwEvent(M(this.type,!1,this.dh,null))}},{key:"update",value:function(){var t=this.dh;t.resetPoints(),t.setPoints(this._points.map((function(t){var e=Wt(t,3);return{lon:e[0],lat:e[1],alt:e[2]}})))}}])&&Vt(e.prototype,n),r&&Vt(e,r),i}(Q);function Xt(t){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Zt(t,e){return(Zt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function te(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=re(t);if(e){var o=re(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ee(this,n)}}function ee(t,e){if(e&&("object"===Xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ne(t)}function ne(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function re(t){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var oe=new D({vertexColors:THREE.VertexColors,size:2,sizeAttenuation:!1}),ie=new D,ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zt(t,e)}(i,t);var e,n,r,o=te(i);function i(t,e,n){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(r=o.call(this))._panogl=t,r._scene=e;var a=n.min,u=n.max,s=new E;s.addAttribute("position",new P(new Float32Array([]),3));var c=new m(s,ie);e.add(c),s.boundingBox=n;var l=new T;return l.setFromPoints([a,u]),s.boundingSphere=l,r._bounder=c,r._seen=!1,r._onBeforeRender=r._onBeforeRender.bind(ne(r)),c.onBeforeRender=r._onBeforeRender,r._onWorkerMessage=r._onWorkerMessage.bind(ne(r)),r}return e=i,(n=[{key:"_onBeforeRender",value:function(){this._seen||(this._seen=!0,this.waitingForDownload=!0,this._bounder.visible=!1,this.throwEvent({type:i.SEEN,target:this}))}},{key:"setPosition",value:function(t){var e=this._points;e.position.x=t.x,e.position.y=t.y,e.position.z=t.z}},{key:"destroy",value:function(){this._abort=!0;var t=this._bounder;if(t){var e=t.parent;e&&e.remove(t),t.geometry.dispose()}var n=this._points;if(n){var r=n.parent;r&&r.remove(n),n.geometry.dispose()}this._scene=null}},{key:"setData",value:function(t,e){this._data=t,this._standingData=e}},{key:"getData",value:function(){return this._data}},{key:"load",value:function(t){var e=this;if(!this._abort){var n=this._data.id,r=I.getByID(n);void 0===r?l(t).then((function(t){if(!e._abort)return t.json()})).then((function(t){if(!e._abort)if(t&&t.success){var r=t.points;I.addByID(r,n),e._processPoints(r)}else console.log("Not succesfull")})):this._processPoints(r)}}},{key:"addPointsToVertices",value:function(t){if(!this._abort){var e=new O;t.forEach((function(t){var n=new A(t.x,t.y,t.z);e.vertices.push(n);var r=Math.sqrt(n.x*n.x+n.z*n.z);e.colors.push(new w(r/800,1-r/2500,0))}));var n=this._scene,r=new m(e,oe);n.add(r),this._points=r}}},{key:"_onWorkerMessage",value:function(t){var e=this._currentWorker,n=t.data;"CARTESIAN_POINTS"===n.type?(this.addPointsToVertices(n.points),AnkaPanAPI.WorkerManager.releaseWorker(e),this.throwEvent({type:i.COMPLETE,target:this})):console.log(t.data),e.removeEventListener("message",this._onWorkerMessage)}},{key:"_processPoints",value:function(t){if(!this._abort){var e=window.getWorker(),n=AnkaPanAPI.WorkerManager.getBlobWorker("PointBox",e);n.addEventListener("message",this._onWorkerMessage);var r=this._standingData,o={alt:r.altitude,lat:r.lat,lon:r.lon};n.postMessage({type:"SET_DATA",points:t,center:o,cameraHeightInPX:this._panogl.groundMaster.cameraHeightInPixel,cameraHeightInMeter:this._panogl.groundMaster.cameraHeight}),this._currentWorker=n,n.postMessage({type:"START"})}}}])&&Jt(e.prototype,n),r&&Jt(e,r),i}(o);function ue(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}ae.SEEN="onSeen",ae.COMPLETE="onComplete";var se=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._scene=new g,this._disabled=!1,this._url=e,this.panogl=r,this._bounds=[],this._queue=[],this._inProgress=[],this._currentGID=0,this._serviceID=n,r.addEvent(i.DATA_COMPLETE,this,this.onDataComplate)}var e,n,r;return e=t,(n=[{key:"setDisable",value:function(t){this._disabled!==t&&(t?this.clear():this.refresh(),this.panogl.setDirty()),this._disabled=t}},{key:"onDataComplate",value:function(t){var e=this,n=t.data.current;this._standingPoint=n,this._currentGID=n.gid,clearTimeout(this._timeout),this.clear(),this._disabled||(this._timeout=setTimeout((function(){return e.refresh()}),200))}},{key:"clear",value:function(){this._inProgress.length=0,this._queue.length=0;var t=this._bounds;t.forEach((function(t){return t.destroy()})),t.length=0}},{key:"refresh",value:function(){var t=this._standingPoint;if(t){var e=t.lat,n=t.lon;this.loadData(n,e)}}},{key:"loadData",value:function(t,e){var n=this,r=this._url+"pc/around/".concat(this._serviceID,"/").concat(t,"/").concat(e),o=this._currentGID;AnkaPanAPI.AnkaFetch(r).then((function(t){return t.json()})).then((function(t){t.success?o===n._currentGID&&n._setPointParams(t.points):console.log("No data found"),n.panogl.setDirty()})).catch((function(t){console.log(t)}))}},{key:"_setPointParams",value:function(t){var e=this;t.forEach((function(t,n){var r=parseFloat(t.maxx),o=parseFloat(t.maxy),i=parseFloat(t.maxz),a=parseFloat(t.minx),u=parseFloat(t.miny),c=parseFloat(t.minz),l=e.panogl,f=l.getGroundMaster().cameraHeightInPixel,h=l.getGroundMaster().cameraHeight,p=e._standingPoint,y=s.loc2Pos(p,a,u,c,f,h),d=s.loc2Pos(p,r,o,i,f,h),v=new A(y.x,y.y,y.z),b=new A(d.x,d.y,d.z),_=new S(v,b),m=new ae(l,e._scene,_);m.gid=e._currentGID,m.bid=e._currentGID+"_"+n,m.setData(t,p),m.addEvent(ae.SEEN,e,e._onBoundSeen),m.addEvent(ae.COMPLETE,e,e._onBoxAddedToScene),e._bounds.push(m)}))}},{key:"_onBoundSeen",value:function(t){var e=t.target;this._queue.push(e),this._loadNext()}},{key:"_onBoxAddedToScene",value:function(t){var e=t.target,n=this._inProgress,r=n.indexOf(e);n.splice(r,1),this.panogl.setDirty(),this._loadNext()}},{key:"_loadNext",value:function(){if(this._inProgress.length<10&&this._queue.length>0){var t=this._queue.shift();this._inProgress.push(t);var e=t.getData(),n=this._url+"pc/fetch/".concat(this._serviceID,"/").concat(e.id);t.load(n)}}},{key:"update",value:function(){if(!this._disabled){var t=this.panogl,e=this._scene,n=t.getRenderer(),r=t.getMainCamera();n.clearDepth(),n.render(e,r)}}}])&&ue(e.prototype,n),r&&ue(e,r),t}(),ce={POINT:0,LINE:1,POLYGON:2,HLINE:3,SQUARE:4,GROUND_FROM_TOP:5,SLOPE:7};function le(t){AnkaPanAPI.PanoPlugin.apply(this,[]);var e=t.enablePoints,n=t.url,r=t.serviceID;this._serviceID=_(r,0),this._enablePoints=e,this._url=n+(/(\/|\\)$/.test(n)?"":"/"),this.cloneable=!1,this._onToolStatusComplete=this._onToolStatusComplete.bind(this),this._noDepth=!0,Object.defineProperties(this,{enablePoints:{set:function(t){this._enablePoints=t,this._pointLoader.setDisable(!this._enablePoints)},get:function(){return this._enablePoints}}})}le._counter=0,le.DRAW_TYPES=ce,le.prototype=Object.assign(Object.create(AnkaPanAPI.PanoPlugin.prototype),{constructor:le,_pointScene:new THREE.Scene,_cursorScene:new THREE.Scene,_id:"pc_"+le._counter++,_currentGID:void 0,_visibility:!0,allowDownload:!0,prepare:function(t){var e=this,n=this.baseObject;this._pointLoader=new se(this._url,this._serviceID,n),this._pointLoader.setDisable(!this._enablePoints),p.getInstance().addPanoGLInstance(this),n.getCloudInstance=function(){return e},n.addEvent(i.RENDER_AFTER_GROUND,this,this.onRenderAfterGround)},getURL:function(){return this._url},setLoadData:function(t){this._loadPoints!==t&&(this._loadPoints=t)},startDrawing:function(t,e){var n;if(e=_(e,this._serviceID),this.stopDraw(),t===ce.POINT)n=new it(this.baseObject);else if(t===ce.LINE)n=new yt(this.baseObject);else if(t===ce.POLYGON)n=new Ut(this.baseObject);else{if(t===ce.HLINE)return alert("This tool cannot be used!");t===ce.SLOPE?n=new Et(this.baseObject):t===ce.SQUARE?n=new It(this.baseObject):t===ce.GROUND_FROM_TOP?n=new Qt(this.baseObject):t===ce.PROFILE?console.log("DRAW_TYPES.PROFILE deprecated"):t===ce.PROFILE2&&console.log("DRAW_TYPES.PROFILE2 deprecated")}n?(n.serviceID=e,this._noDepth?n.disableDepth():n.enableDepth(),n.addEvent("onStatusChange",this._onToolStatusComplete),this._currentTool=n):console.warn("invalid tool")},addPointToDraw:function(t,e,n){this._currentTool&&this._currentTool.addPoint([t,e,n])},enableDepth:function(){this._noDepth=!1,this._currentTool&&this._currentTool.disableDepth()},disableDepth:function(){this._noDepth=!0,this._currentTool&&this._currentTool.enableDepth()},stopDraw:function(){this._currentTool&&(this._currentTool.endBadDraw(),this.destroyDraw(),this._currentTool=null)},destroyDraw:function(){this._currentTool&&this._currentTool.destroy(),this._currentTool=null},_onToolStatusComplete:function(t){"FINISHED"===t.status&&this.destroyDraw(),this.throwEvent(t)},setVisibility:function(t){this._visibility=t,this.setDirty()},onRenderAfterGround:function(){this._pointLoader.update()},_setPointParams:function(t){this._pointMeta=t.map((function(t){return Object.assign({},t)})),this._nextID=0;for(var e=0;e<10&&this._nextID<this._pointMeta.length-1;e++)this._nextID=e,this.addPointData(this._pointMeta[e],e)},addPointData:function(t,e){var n=this;if(t){var r=t.id,o=this._url+"/pc/fetch/".concat(r),i=I.getByID(r);if(void 0!==i)return void this._processPoints(i);var a=this._currentGID;AnkaPanAPI.AnkaFetch(o).then((function(t){if(a===n._currentGID)return t.json()})).then((function(t){if(a===n._currentGID)if(t&&t.success){var e=t.points;I.addByID(e,r),n._processPoints(e)}else console.log("Not succesfull")}))}},clearData:function(){for(var t=this._pointScene,e=t.children;e.length>0;){var n=e[0];n.geometry.dispose(),n.material.dispose(),t.remove(n)}}}),le.STATUS_CHANGE="onStatusChange"}})}));
//# sourceMappingURL=bundle.AnkaPointCloud.js.map