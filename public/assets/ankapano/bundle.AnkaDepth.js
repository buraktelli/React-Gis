!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AnkaDepth=t():e.AnkaDepth=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}({0:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return o}));var r={};window.Utils={},r.webglAvailable=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}};var o=Math.PI/180;window.TO_RAD=o;var a,i,u,c=180/Math.PI;window.TO_DEG=c,r.isTouchDevice=function(){return"ontouchstart"in window||window.DocumentTouch},r.isComputer=function(){return void 0===window.orientation},r.isMobileOrTablet=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},r.sortDist=function(e,t){return e.dist-t.dist},r.sortAzimuth=function(e,t){return e.azimuth-t.azimuth},r.bearing=function(e,t,n,r){var a=e*o,i=n*o,u=Math.cos(i),s=(r-t)*o;return Math.atan2(Math.sin(s)*u,Math.cos(a)*Math.sin(i)-Math.sin(a)*u*Math.cos(s))*c},r.GetNormal=function(e,t,n){var r=t.x-e.x,o=t.y-e.y,a=t.z-e.z,i=n.x-e.x,u=n.y-e.y,c=n.z-e.z,s={};return s.x=o*c-a*u,s.y=a*i-r*c,s.z=r*u-o*i,s},r.heversine=function(e,t,n,o){return r.haversine(e,t,n,o)},r.haversine=function(e,t,n,r){var a=e*o,i=t*o,u=(t-e)*o,c=(r-n)*o,s=Math.sin(u/2)*Math.sin(u/2)+Math.cos(a)*Math.cos(i)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},r.ParseLabelString=function(e,t){if(void 0===e||!e)return"";var n=t.getCommonGeom();void 0===n&&console.error("undefined variable");for(var r=e.split(","),o="",a=0;a<r.length;a++)if(a>0&&(o+=","),0===r[a].indexOf("FUNC>>")){var i=r[a].replace("FUNC>>","");"function"==typeof window[i]?o+=window[i](t):o+="Funcli"}else{var u="",c="",s=r[a].split("|");s.length>1&&(u=s[1]),s.length>2&&(c=s[2]);var l=s[0];"#"===l[0]&&(l=l.substr(1,l.length-1),l=n.attributes[l]),o+=c+l+u}return o},r.destinationPoint=function(e,t,n,r){var a=Number(n)/6371e3,i=Number(r)*o,u=e*o,s=t*o,l=Math.asin(Math.sin(u)*Math.cos(a)+Math.cos(u)*Math.sin(a)*Math.cos(i)),f=s+Math.atan2(Math.sin(i)*Math.sin(a)*Math.cos(u),Math.cos(a)-Math.sin(u)*Math.sin(l));return f=(f+3*Math.PI)%(2*Math.PI)-Math.PI,{lat:l*c,lon:f*c}},r.angleDifference=function(e,t){return 180-Math.abs(Math.abs(e-t)-180)},r.cross=function(e,t){return{x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x}},r.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},r.norm2=function(e){return e.x*e.x+e.y*e.y+e.z*e.z},r.vmul=function(e,t){return{x:e.x*t.x,y:e.y*t.y,z:e.z*t.z}},r.heron=function(e,t,n){var r=(e+t+n)/2,o=r-e,a=r-t,i=r-n;return Math.sqrt(r*o*a*i)},r.createTextTexture=function(e,t){var n=u;i?(i.style.display="block",n.clearRect(0,0,i.clientWidth,i.clientHeight)):((i=document.createElement("canvas")).id="textureA",n=i.getContext("2d"),document.body.appendChild(i),i.style.position="absolute",i.style.top="0px",i.style.left="0px",u=n);t=t||{r:50,g:50,b:50,a:1},n.strokeStyle="rgba("+t.r+","+t.g+","+t.b+","+t.a+")",n.lineWidth=4,n.font="Bold 60px  Arial",n.fillStyle="rgba(255, 255,255, 0.4)",n.textAlign="center",n.strokeText(e,512,68),n.fillText(e,512,68),i.style.display="none";var r=new THREE.Texture(u.getImageData(0,0,1024,128));return r.needsUpdate=!0,r},r.createTextTextureForGround=function(e){var t=u,n=a;a?(a.style.display="block",t.clearRect(0,0,a.clientWidth,a.clientHeight)):((a=document.createElement("canvas")).id="groundCanvas",t=a.getContext("2d"),document.body.appendChild(a),a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.width=1024,a.height=128,a.style.background="#ff0000",u=t,n=a);var r=50,o=50,i=50,c=1;t.strokeStyle="rgba("+r+","+o+","+i+","+c+")",t.lineWidth=4,t.font="Bold 60px  Arial";var s=t.measureText(e).width;t.fillStyle="rgba(255, 255,255, 1)",t.textAlign="center",t.textBaseline="middle",t.strokeText(e,512,64),t.fillText(e,512,64),n.style.display="none";var l=new THREE.Texture(u.getImageData(0,0,1024,128));return l.needsUpdate=!0,{texture:l,textWidth:s,fontHeight:96}},r.makeTextSprite=function(e,t,n,o,a,c,s,l){var f=1.6*(n=(n||30)/2),h=s&&void 0!==s?s:2;a=a||{r:111,g:111,b:111,a:1},o=o||{r:209,g:209,b:209,a:.6},c=c||{r:0,g:0,b:0,a:1},l=l&&void 0!==l?l:6;var d=u;i?(i.style.display="block",d.clearRect(0,0,2048,2048)):((i=document.createElement("canvas")).id="textureA",d=i.getContext("2d"),document.body.appendChild(i),i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.width=2048,i.height=2048,u=d),d.textBaseline="alphabetic",d.textAlign="start",d.font="Bold "+n+"px Arial";var p,y=d.measureText(t).width+10;if(d.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",d.strokeStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",d.lineWidth=h,r.roundRect(d,h/2,h/2,y+5,1.4*n+h,l),d.fillStyle="rgba("+c.r+", "+c.g+","+c.b+", "+c.a+")",d.fillText(t,h+5,n+h),i.style.display="none",!e){var v=new THREE.Texture(u.getImageData(0,0,y+60,f));v.needsUpdate=!0,v.generateMipmaps=!1,v.minFilter=THREE.LinearFilter,p=new THREE.SpriteMaterial({map:v,depthTest:!1,depthWrite:!1});var m=new THREE.Sprite(p);return m.scale.set(y,50,1),m}var b=e.material,g=u.getImageData(0,0,y+7,f),_=b.map;b.map.image=g,b.map.needsUpdate=!0,b.needsUpdate=!0,e.scale.set(y,f,1),_.dispose()},r.roundRect=function(e,t,n,r,o,a){e.beginPath(),e.moveTo(t+a,n),e.lineTo(t+r-a,n),e.quadraticCurveTo(t+r,n,t+r,n+a),e.lineTo(t+r,n+o-a),e.quadraticCurveTo(t+r,n+o,t+r-a,n+o),e.lineTo(t+a,n+o),e.quadraticCurveTo(t,n+o,t,n+o-a),e.lineTo(t,n+a),e.quadraticCurveTo(t,n,t+a,n),e.closePath(),e.fill(),e.stroke()},r.mergeStringForUrl=function(e,t){var n,r=e;for(n=e.length-1;n>=0;n--)if("/"!==e[n]){r=e.substr(0,n+1);break}var o=t;for(n=0;n<t.length;n++)if("/"!==t[n]){o=t.substr(n,t.length-n);break}return r+"/"+o},r.loadScript=function(e,t){var n=document.getElementsByTagName("head")[0],r=document.createElement("script"),o=!1;r.setAttribute("src",e),r.setAttribute("type","text/javascript"),r.setAttribute("charset","utf-8"),r.onload=r.onreadstatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,r.onload=r.onreadystatechange=null,t&&t())},n.insertBefore(r,n.firstChild)},r.setDef=function(e,t){return void 0!==e?e:t}},12:function(e,t,n){"use strict";n.r(t),n.d(t,"DepthPlugin",(function(){return V}));var r=n(0);function o(e,t,n){return{drawType:e,type:"onStatusChange",status:"FINISHED",isSuccessful:t,feature:n}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(s,AnkaPanAPI.Base);var t,n,r,a=c(s);function s(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=a.call(this)).type=t,n._depthPlugin=e;var r=AnkaScalable.SPolygon;"Point"===t?r=AnkaScalable.SPoint:"Line"===t?r=AnkaScalable.SLine:"Polygon"===t&&(r=AnkaScalable.SPolygon);return n.gdh=new AnkaScalable.GeomDataHolder(r,[],{}),n.gdh.setStatus(AnkaScalable.GeomDataHolder.STATUS.DRAWING),AnkaScalable.GeometryObserver.addGeometries([n.gdh]),n}return t=s,(n=[{key:"removeLastPoint",value:function(){this.gdh.removeLastPoint(),this.throwEvent({type:"onStatusChange",feature:this.gdh,status:"LAST_POINT_REMOVED",drawType:this.type})}},{key:"addPoint",value:function(e){this.gdh.addPoint(e),this.onPointAdd(e)}},{key:"onPointAdd",value:function(e){var t=e.lon,n=e.lat,r=e.alt;this.throwEvent({type:"onStatusChange",feature:this.gdh,status:"POINT_ADDED",drawType:this.type,lon:t,lat:n,alt:r})}},{key:"endDraw",value:function(){throw new Error("Not implemented")}},{key:"badEnd",value:function(){var e=this.gdh;e.setStatus(AnkaScalable.GeomDataHolder.STATUS.BAD_COMPLETED),AnkaScalable.GeometryObserver.removeGeometry(this.gdh),this.throwEvent(o(this.type,!1,e))}}])&&i(t.prototype,n),r&&i(t,r),s}();function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var o=m(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return v(this,n)}}function v(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(i,e);var t,n,r,a=y(i);function i(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=a.call(this)).type="Line",n._depthPlugin=e;var r=AnkaScalable.SLine;return n.gdh=new AnkaScalable.GeomDataHolder(r,[],{}),n.gdh.setStatus(AnkaScalable.GeomDataHolder.STATUS.DRAWING),AnkaScalable.GeometryObserver.addGeometries([n.gdh]),n}return t=i,(n=[{key:"endDraw",value:function(){var e=this.gdh,t=e.getPointLength(),n=AnkaScalable.GeomDataHolder,r=!1;t<2?(e.setStatus(n.STATUS.BAD_COMPLETED),AnkaScalable.GeometryObserver.removeGeometry(this.gdh)):(r=!0,e.setStatus(n.STATUS.COMPLETED)),this.throwEvent(o(this.type,r,e))}}])&&d(t.prototype,n),r&&d(t,r),i}(f);function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=E(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E(e);if(t){var o=E(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return T(this,n)}}function T(e,t){if(t&&("object"===g(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(i,e);var t,n,r,a=P(i);function i(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),a.call(this,e,"Point")}return t=i,(n=[{key:"onPointAdd",value:function(e){var t=this;S(E(i.prototype),"onPointAdd",this).call(this,e),this.gdh.getPointLength()>0&&setTimeout((function(){return t.endDraw()}))}},{key:"endDraw",value:function(){var e=this.gdh,t=e.getPointLength(),n=AnkaScalable.GeomDataHolder,r=!1;t<1?(e.setStatus(n.STATUS.BAD_COMPLETED),AnkaScalable.GeometryObserver.removeGeometry(this.gdh)):(r=!0,e.setStatus(n.STATUS.COMPLETED)),this.throwEvent(o(this.type,r,e))}}])&&_(t.prototype,n),r&&_(t,r),i}(f);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=D(e);if(t){var o=D(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return M(this,n)}}function M(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(i,e);var t,n,r,a=C(i);function i(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=a.call(this)).type="Polygon",n._depthPlugin=e;var r=AnkaScalable.SPolygon;return n.gdh=new AnkaScalable.GeomDataHolder(r,[],{}),n.gdh.setStatus(AnkaScalable.GeomDataHolder.STATUS.DRAWING),AnkaScalable.GeometryObserver.addGeometries([n.gdh]),n}return t=i,(n=[{key:"endDraw",value:function(){var e=this.gdh,t=e.getPointLength(),n=AnkaScalable.GeomDataHolder,r=!1;t<2?(e.setStatus(n.STATUS.BAD_COMPLETED),AnkaScalable.GeometryObserver.removeGeometry(this.gdh)):(r=!0,e.setStatus(n.STATUS.COMPLETED)),this.throwEvent(o(this.type,r,e))}}])&&A(t.prototype,n),r&&A(t,r),i}(f);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=F(e);if(t){var o=F(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return z(this,n)}}function z(e,t){if(t&&("object"===j(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return H(e)}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B={LINE:"LINE",POINT:"POINT",POLYGON:"POLYGON"},V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(i,AnkaPanAPI.PanoPlugin);var t,n,o,a=U(i);function i(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=a.call(this);var n=e.url;if(void 0===n)throw new Error('"url" param cannot be undefined');return t._url="/"===n[n.length-1]?n.substr(0,n.length-1):n,t.cloneable=!1,t.onKeyDown=t.onKeyDown.bind(H(t)),t.onKeyUp=t.onKeyUp.bind(H(t)),t._onToolStatusChange=t._onToolStatusChange.bind(H(t)),t}return t=i,(n=[{key:"start",value:function(e){if(this.currentTool)this.stop();else{var t=this.baseObject.getScalable();if(e===B.POINT?this.currentTool=new x(this,t.getMainSketchLayer()):e===B.LINE?this.currentTool=new b(this,t.getMainSketchLayer()):e===B.POLYGON&&(this.currentTool=new R(this,t.getMainSketchLayer())),this.currentTool){this.currentTool.addEvent("onStatusChange",this,this._onToolStatusChange);var n=this.baseObject;n.disableGroundNav(!0),n.getGroundMaster().showGroundSymbol(!1),n.addEvent(AnkaPanAPI.PanoGLV2.RENDER_AFTER_GROUND,this,this._onRender),n.addEvent(AnkaPanAPI.PanoGLV2.MOUSE_MOVE2D,this,this._onMouseMove),n.addEvent(AnkaPanAPI.PanoGLV2.SAFE_CLICK2D,this,this._onClick),n.addEvent(AnkaPanAPI.PanoGLV2.LOCATION_CHANGE,this,this._onLocationChange),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),this._onLocationChange(),this.throwEvent({type:"onStatusChange",feature:this.currentTool.gdh,status:"STARTED",drawType:this.currentTool.type})}}}},{key:"_onToolStatusChange",value:function(e){"FINISHED"===e.status&&this.stop(),this.throwEvent(e)}},{key:"_onClick",value:function(e){var t=e.nativeEvent.button;this.currentTool&&(2===t?this.currentTool.endDraw():1===t&&this.currentTool.removeLastPoint()),this._mouselastPoint&&this.currentTool&&0===t&&this.currentTool.addPoint(this._lastCoord)}},{key:"stop",value:function(){this.currentTool&&this.currentTool.removeEvent("onStatusChange",this._onToolStatusChange),this.currentTool=null,AnkaPanAPI.CursorManager.setCursor("auto",-1,!0);var e=this.baseObject,t=e.getGroundMaster();e.disableGroundNav(!1),t.showGroundSymbol(!0),e.removeEvent(AnkaPanAPI.PanoGLV2.RENDER_AFTER_GROUND,this._onRender),e.removeEvent(AnkaPanAPI.PanoGLV2.MOUSE_MOVE2D,this._onMouseMove),e.removeEvent(AnkaPanAPI.PanoGLV2.SAFE_CLICK2D,this._onClick),e.removeEvent(AnkaPanAPI.PanoGLV2.LOCATION_CHANGE,this._onLocationChange),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}},{key:"onKeyDown",value:function(e){17===e.keyCode?this._getMaterial().uniforms.showDepth.value=!0:27===e.keyCode&&this.currentTool&&this.currentTool.badEnd()}},{key:"onKeyUp",value:function(e){17===e.keyCode&&(this._getMaterial().uniforms.showDepth.value=!1)}},{key:"_createSphere",value:function(){var e=this._cursorScene,t=this._getMaterial(),n=new THREE.SphereBufferGeometry(1e3,500,500),r=new THREE.Mesh(n,t);r.scale.set(-1,1,1);var o=new THREE.Object3D;o.add(r),e.add(o),this._sphere=r,this.cover=o}},{key:"_getVertexStr",value:function(){return"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"}},{key:"loadTexture",value:function(e){this._textureManager||(this._textureManager=new THREE.TextureLoader,this._textureManager.setCrossOrigin("anonymous"));var t=this._textureManager.load(e);return t.magFilter=THREE.NearestFilter,t.minFilter=THREE.LinearFilter,t}},{key:"_getDepthTexture",value:function(){return this._depthTexture}},{key:"_getFragmentStr",value:function(){return"\n#include <packing>\nvarying vec2 vUv;\nuniform float u_heading;\nuniform vec3 mouseScreenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 u_sphere_inverse;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform sampler2D t_depth;\nuniform float rangeAlpha;\nuniform bool isForDistance;\nuniform bool showDepth;\nconst float PI = 3.1415926535897932384626433832795;\nconst float SCALE = 1000.0;\n\nbool isDepthValid(vec4 depth_px) {\n    if(depth_px.a < 0.2) return false;\n    return !(depth_px.r == 0.0 && depth_px.b == 0.0 && depth_px.g == 0.0);\n}\n\nbool isPositionValid(vec3 position) {\n    return !(position.r == 0.0 && position.b == 0.0 && position.g == 0.0);\n}\n\nfloat packColor(vec3 color) {\n    float red = color.r;\n    float green = color.b;\n    float blue = color.g;\n    return blue + green * 256.0 + red * 256.0 * 256.0;\n}\n\nvec3 getDepthCoord(vec3 color, vec2 uv) {\n    float RADIAN = (u_heading  - (180.0+90.0)) / 180.0 * PI;\n    float dist_from_cam = packColor(color * 255.0) / SCALE;\n    float pitch_in_rad = (uv.y - 0.5) * PI;\n    float yaw_in_rad = (uv.x * (PI * 2.0)) + RADIAN;\n    float neighbour = cos(pitch_in_rad) * dist_from_cam;\n    float y = sin(pitch_in_rad) * dist_from_cam;\n    float x = cos(yaw_in_rad) * neighbour;\n    float z = sin(yaw_in_rad) * neighbour;\n    return vec3(x,y,z);\n}\n\n\nvoid main() {\n\n    float dist = distance(gl_FragCoord.xy, mouseScreenPosition.xy);\n\n    if(isForDistance) {\n\n        if(dist < 1.0) {\n            vec4 depthTexture = texture2D(t_depth, vUv);\n            if(!isDepthValid(depthTexture)) {\n                gl_FragColor = vec4(0.0, 0.0, 0.0,1.0);\n                return;\n            }\n\n            float depth_distance = packColor(depthTexture.rgb * 255.0) / SCALE;\n            if(depth_distance < 2.35) {\n                gl_FragColor = vec4(0.0, 0.0, 0.0,1.0);\n                return;\n            }\n            gl_FragColor = depthTexture;\n        } else {\n            gl_FragColor = vec4(0.0, 0.0, 0.0,0.0);\n            return;\n        }\n\n        return;\n    }\n\n    if(!isPositionValid(mouseScreenPosition)) {\n        discard;\n    }\n\n    vec4 depthTexture = texture2D(t_depth, vUv);\n    if(isDepthValid(depthTexture)) {\n        vec3 depth_coord = getDepthCoord(depthTexture.rgb, vUv);\n        float depth_distance = packColor(depthTexture.rgb * 255.0) / SCALE;\n        float dist = distance(depth_coord, mouseScreenPosition);\n        float CIRCLE_RADIUS = 0.6;\n        if(dist < CIRCLE_RADIUS) {\n            vec4 circleColor = vec4( 1.0, 1.0, 0.0, 1.0 );\n            vec4 circleColor2 = vec4( 1.0, 1.0, 1.0, 0.1 );\n            float lineSize = CIRCLE_RADIUS / 3.0;\n            float thLine = mod(dist,lineSize);\n            gl_FragColor.rgba = mix(circleColor2, circleColor, step(lineSize / 2.0,thLine));\n        } else {\n            // discard;\n\n            if(showDepth) {\n                gl_FragColor.rgb = depthTexture.rgb;\n                gl_FragColor.a = rangeAlpha;\n            } else {\n                discard;\n            }\n        }\n\n    } else {\n        discard;\n    }\n}\n"}},{key:"_onMouseMove",value:function(e){this._mouseX=e.nativeEvent.offsetX,this._mouseY=e.nativeEvent.offsetY,this._ray=e.ray.direction.clone(),this.baseObject.getGroundMaster().showGroundSymbol(!1)}},{key:"_getMaterial",value:function(){if(!this._shaderMaterial){var e=this.baseObject.getMainCamera();this._shaderMaterial=new THREE.ShaderMaterial({transparent:!0,fragmentShader:this._getFragmentStr(),vertexShader:this._getVertexStr(),uniforms:{mouseScreenPosition:{value:new THREE.Vector3(0,0)},t_depth:{value:this._getDepthTexture()},cameraNear:{value:e.near},cameraFar:{value:e.far},rangeAlpha:{value:1},isForDistance:{value:!1},showDepth:{value:!1},u_heading:{value:0}}})}return this._shaderMaterial}},{key:"_panoSetupComplete",value:function(){this._createSphere()}},{key:"_onRender",value:function(){this._mouselastPoint=null;var e=this.baseObject,t=e.getMainCamera(),n=e.getRenderer(),o=this._getMaterial(),a=e.getRenderer().context;if("number"==typeof this._mouseX){var i=e.getRendererDom().clientHeight-this._mouseY;o.uniforms.isForDistance.value=!0,o.uniforms.mouseScreenPosition.value.x=this._mouseX,o.uniforms.mouseScreenPosition.value.y=i,n.clearDepth(),n.render(this._cursorScene,t);var u=new Uint8Array(4e4);a.readPixels(this._mouseX,i,100,100,a.RGBA,a.UNSIGNED_BYTE,u);var c=L(u,3),s=function(e,t,n){return e<<16|n<<8|t}(c[0],c[1],c[2])/1e3;if(s>.1){var l=this._ray,f=-Math.atan2(l.x,l.z)+.5*Math.PI,h=Math.asin(l.y),d=Math.sin(h)*s,p=Math.cos(h)*s,y=e.getCurrentPoint(),v=y.lon,m=y.lat,b=y.altitude+d,g=AnkaPanAPI.Utils.destinationPoint(m,v,p,f*r.a+90);this._lastCoord=Object.assign({alt:b},g);var _=Math.cos(h)*s,S=Math.sin(h)*s,w=Math.cos(f)*_,P=Math.sin(f)*_;this._mouselastPoint={cartesianX:w,cartesianY:S,cartesianZ:P},AnkaPanAPI.CursorManager.setCursor("crosshair",666)}else this._lastCoord=null,this._lastCoord=null,AnkaPanAPI.CursorManager.setCursor("not-allowed",666)}this._mouselastPoint&&(o.uniforms.mouseScreenPosition.value.x=this._mouselastPoint.cartesianX,o.uniforms.mouseScreenPosition.value.y=this._mouselastPoint.cartesianY,o.uniforms.mouseScreenPosition.value.z=this._mouselastPoint.cartesianZ,o.uniforms.isForDistance.value=!1,n.clearDepth(),n.render(this._cursorScene,t))}},{key:"_onLocationChange",value:function(){var e=this.baseObject,t=e.getCurrentPoint(),n=t.parent,r=t.dirname,o=t.img,a=t.heading;o=o.replace(".jpeg",".png");var i=[this._url,"depth",n,r,o].filter((function(e){return(e+"").trim()})).join("/"),u=this.loadTexture(i),c=this._getMaterial(),s=e.dataParser.getCurrentConfig();window._textureMap=u,c.uniforms.t_depth.value=u,c.uniforms.u_heading.value=a+s.heading,c.needsUpdate=!0}},{key:"onOrientationChanged",value:function(e){var t=this._sphere,n=this._cursorScene,o=e.heading;e.roll,e.pitch;var a=-o-90*r.b,i=-90*r.b;this.cover.rotation.set(0,-i,-0,"YXZ"),t.rotation.set(0,i,0,"YXZ"),n.rotation.set(0,a,0),this.isDirty=!0}},{key:"prepare",value:function(){var e=this.baseObject,t=this;e.getDepthPlugin=function(){return t},this._cursorScene=new THREE.Scene,e.addEvent(AnkaPanAPI.PanoGLV2.SETUP_COMLETE,this,this._panoSetupComplete),e.addEvent(AnkaPanAPI.PanoGLV2.ORIENTATION_CHANGED,this,this.onOrientationChanged)}}])&&G(t.prototype,n),o&&G(t,o),i}();V.TYPES=B,V.CLICK="onClick",V.STATUS_CHANGE="onStatusChange"}})}));
//# sourceMappingURL=bundle.AnkaDepth.js.map